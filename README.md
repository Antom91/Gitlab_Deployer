# Сценарий автоматического развертывания GitLab-CE CI на Debian подобных ОС

### Инструкция:
1) Склонировать репозиторий:
```
git clone https://toshuk-kr@bitbucket.org/toshuk-kr/gitlab_installer.git
```

2) Сгенерировать ключи доступа на нужных хостах:
```
ssh-keygen
ssh-copy-id 
```

3) Отредактировать файл **settings.cfg**:
```
server1   ansible_host=0.0.0.0   ansible_user=root   gitlab_version=latest
```

4) Запустить сценарий на выполнение:
```
ansible-playbook gitlab.yml
```
---

### Более полное описание:

#### **Для генерации ключей доступа к серверу, используем команды:**

* **ssh-keygen** – генератор ключей доступа, после ввода данной команды, Вам поступит предложение указать путь (что делать не нужно) и задать passphrase, на что отвечаем нажатием кнопки **Enter** (ничего не вводим)

* **ssh-copy-id** – команда для передачи ключа. Синтаксис команды такой: **ssh-copy-id user@host**

Где **user** вписываем имя пользователя, где **host** – хост которому хотим передать ключ. Данную процедуру нужно произвести на двух хостах, это нужно для обмена генерированных ключей.

#### **Редактирование файла settings.cfg:**

В данном файле Вам нужно изменить адрес удаленного сервера, пользователя и вписать желаемую версию **GitLab**, например **gitlab_version=9.5.1-ce.0** . Если указать **gitlab_version=latest** то установится последняя, актуальная версия **GitLab**

---

### Возможные проблемы и пояснения:

Если сценарий не выполняется по причине того, что нужен sudo пароль, выполните эту команду на мастере (хосте на котором запускаете Ansible)
**export ANSIBLE_ASK_SUDO_PASS=true**. Тестировалось на разных системах, на некоторых эту команду вводить не нужно. В моем случаи на **Debian 8** пришлось вводить.

**GitLab** разворачивался на Ubuntu Trusty, все работало без нареканий и стабильно.